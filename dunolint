(lang dunolint 1.0)

;; Everything is instrumented

(rule
 (cond
  (true
   (enforce
    (dune
     (instrumentation
      (backend bisect_ppx)))))))

;; Test lib naming

(rule
 (cond
  ((path
    (glob test/**))
   (enforce
    (dune
     (library
      (and
       (not
        (has_field public_name))
       (has_field inline_tests)
       (package
        (equals crs-tests))
       (name
        (is_suffix _test)))))))))

;; Configure the ppx_js_style linter

(rule
 (cond
  ((path
    (glob src/reviewdog/test/**))
   return)
  (true
   (enforce
    (dune
     (lint
      (pps
       (and
        (pp ppx_js_style)
        (flag
         (name -allow-let-operators)
         (param none)
         (applies_to
          (pp ppx_js_style)))
        (flag
         (name -check-doc-comments)
         (param none)
         (applies_to
          (pp ppx_js_style)))))))))))

(rule
 (cond
  ((path
    (or
     (glob src/crs/**)
     (glob src/rewiewdog/src/*)
     (glob src/stdlib/**)))
   (enforce
    (dune
     (preprocess no_preprocessing))))))
